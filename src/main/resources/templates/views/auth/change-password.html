

<!DOCTYPE html>
<html lang="en" layout:decorate="/layout/_auth"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
>
<head>
    <meta charset="UTF-8">
    <title>Change Password</title>
    <div layout:fragment="style">
        <link rel="stylesheet" th:href="@{/assets/web/css/login-page.css}"/>
    </div>
    <style>
        .logo-container {
            display: flex;
            align-items: center;
        }
    </style>
</head>
<body>
<th:block layout:fragment="content">
    <div class="row" style="justify-content: center; align-items: center">
        <div class="col-sm-6" style="background-color: white; padding-bottom: 20px; padding: 20px; border-radius: 20px; ">
            <div class="d-flex justify-content-center">
                <div class="logo-container">
                    <img src="/assets/images/rupp-logo.png" alt="RUUPBank Logo"/>
                    <div style="font-size: 22px; margin-top: 0px; font-weight: bolder">RUPPBank</div>
                </div>
            </div>
            <div style="margin-bottom:20px                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ;margin-top: 20px;">
                <div class="txtTitle" style="margin-top:60px;">Welcome back,</div>
                <div class="txtTitle">Change Password</div>
            </div>
            <form class="need-validate" novalidate>
                <div class="row">
                    <div class="col-12">
                        <label for="txtNewPass" class="form-label">New Password</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fa fa-key"></i></span>
                            <input type="password" class="form-control" id="txtNewPass" placeholder="New password" required>
                            <div class="invalid-feedback">The password field is required.</div>
                            <div id="idPasswordValidate"></div>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <label for="txtComfirmPass" class="form-label">Confirm Password</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fa fa-key"></i></span>
                            <input type="password" class="form-control" id="txtComfirmPass" placeholder="Confirm Password" required>
                            <div class="invalid-feedback">The confirm password field is required.</div>
                        </div>
                    </div>
                </div>
                <div class="row d-flex justify-content-center align-items-center">
                    <button id="btnSubmit" type="submit" class="cssbuttons-io-button mt-4" style="width: 250px;">
                        Submit
                        <div class="icon">
                            <svg
                                    height="24"
                                    viewBox="0 0 24 24"
                                    width="24"
                                    xmlns="http://www.w3.org/2000/svg"
                            >
                                <path d="M0 0h24v24H0z" fill="none"></path>
                                <path
                                        d="M16.172 11l-5.364-5.364 1.414-1.414L20 12l-7.778 7.778-1.414-1.414L16.172 13H4v-2z"
                                        fill="currentColor"
                                ></path>
                            </svg>
                        </div>
                    </button>
                </div>
            </form>
        </div>
    </div>
</th:block>
<div layout:fragment="script">
    <script th:inline="javascript">

        //FORM LOAD
        $(document).ready(function () {

        });
        //FORM LOAD

        // Hold screen to validation
        var form = document.getElementsByClassName('need-validate');
        var validation = Array.prototype.filter.call(form, function (forms) {
            forms.addEventListener('submit', function (event) {
                if (forms.checkValidity() == false) {
                    event.preventDefault();
                }
                else {
                    event.preventDefault();
                    if ($('#txtNewPass').val() == $('#txtComfirmPass').val()) {

                        var PASSWORD = $('#txtNewPass').val();

                        var json={
                            password: PASSWORD
                        };
                        console.log(JSON.stringify(json));

                        $.ajax({
                            type: "POST",
                            url: "api/v1/auth/change-password",
                            contentType: 'application/json',
                            dataType: 'json',
                            data: JSON.stringify(json),
                            processData: false,
                            success: function (response) {
                                console.log(response)
                                if (response.errorCode === 200){
                                    window.location.href = "/login";
                                }else{

                                }
                            }
                        });
                    }
                    else {
                        Swal.fire({
                            title: "Bad Request",
                            text: "Password Not Matching.",
                            icon: "error"
                        });
                    }
                }
                forms.classList.add('was-validated');
            }, false);
        });

        function customValidatePassword(inputId, errorMessageId, errorText) {
            var input = document.getElementById(inputId);
            var errorMessage = document.getElementById(errorMessageId);
            var pattern = /^(?=.*[!@#\$%\^&\*])(?=.*[A-Z])(?=.*[a-z])(?=.{8,})/;

            input.addEventListener('blur', function() {
                var value = input.value;
                if (!pattern.test(value)) {
                    errorMessage.textContent = errorText;
                    errorMessage.style.display = 'block';
                    errorMessage.classList.add('invalid-feedback');
                    input.setCustomValidity("Invalid input");
                } else {
                    errorMessage.style.display = 'none';
                    errorMessage.classList.remove('invalid-feedback');
                    input.setCustomValidity(""); // Clear the custom validity
                }
            });
        }
        customValidatePassword('txtNewPass','idPasswordValidate','Invalid password. Password must be at least 8 characters long, include special characters, and have both uppercase and lowercase letters.')
    </script>
</div>
</body>

</html>









